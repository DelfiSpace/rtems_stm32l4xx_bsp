#include "stm32l4r9_module_dcmi.h"
// 13.1.4.2 Jpg mode capture
//
void write_i2c(u16, int);

void write_i2c(u16 addr, int val) {
  // wrapper for i2c hal driver
  u8 buffer = val;
  HAL_I2C_Master_Transmit(&hi2c1, addr, &buffer, 1, 1000);
}

void ov5640_configure_jpeg_qsxga(void) {
  write_i2c(0x3820, 0x40);
  write_i2c(0x3821, 0x26);
  write_i2c(0x3814, 0x11);

  write_i2c(0x3815, 0x11);
  write_i2c(0x3803, 0x00);
  write_i2c(0x3807, 0x9f);
  write_i2c(0x3808, 0x0a);

  write_i2c(0x3809, 0x20);
  write_i2c(0x380a, 0x07);
  write_i2c(0x380b, 0x98);
  write_i2c(0x380c, 0x0b);
  write_i2c(0x380d, 0x1c);
  write_i2c(0x380e, 0x07);
  write_i2c(0x380f, 0xb0);
  write_i2c(0x3813, 0x04);

  write_i2c(0x3618, 0x04);
  write_i2c(0x3612, 0x4b);
  write_i2c(0x3708, 0x64);
  write_i2c(0x3709, 0x12);

  write_i2c(0x370c, 0x00);
  write_i2c(0x3a02, 0x07);
  write_i2c(0x3a03, 0xb0);
  write_i2c(0x3a0e, 0x06);

  write_i2c(0x3a0d, 0x08);
  write_i2c(0x3a14, 0x07);
  write_i2c(0x3a15, 0xb0);
  write_i2c(0x4001, 0x02);

  write_i2c(0x4004, 0x06);
  write_i2c(0x3002, 0x00);
  write_i2c(0x3006, 0xff);
  write_i2c(0x3824, 0x04);

  write_i2c(0x5001, 0x83);
  write_i2c(0x3036, 0x69);
  write_i2c(0x3035, 0x31);
  write_i2c(0x4005, 0x1A);
}
